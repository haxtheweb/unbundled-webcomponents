import{LitElement,html,css}from"../../../lit-element/lit-element.js";import{HAXElement,HAXWiring}from"../../hax-body-behaviors/hax-body-behaviors.js";import{varGet}from"../../utils/utils.js";class HaxAutoloader extends(HAXElement(LitElement)){static get styles(){return[css`
        :host {
          display: none;
        }
      `]}render(){return html`
      <slot></slot>
    `}static get tag(){return"hax-autoloader"}pathFromUrl(url){return url.substring(0,url.lastIndexOf("/")+1)}static get properties(){return{...super.properties,processedList:{type:Object}}}constructor(){super(),this.processedList={}}firstUpdated(changedProperties){this.dispatchEvent(new CustomEvent("hax-register-core-piece",{bubbles:!0,cancelable:!0,composed:!0,detail:{piece:"haxAutoloader",object:this}}))}connectedCallback(){super.connectedCallback(),this.observer=new MutationObserver(mutations=>{mutations.forEach(mutation=>{mutation.addedNodes.forEach(node=>{this.processNewElements(node)})})}),this.observer.observe(this,{childList:!0})}disconnectedCallback(){this.observer.disconnect(),super.disconnectedCallback()}processNewElements(e){let effectiveChildren=this.childNodes;for(var i=0;i<effectiveChildren.length;i++){if(void 0!==effectiveChildren[i].tagName&&void 0===this.processedList[effectiveChildren[i].tagName])try{let name=effectiveChildren[i].tagName.toLowerCase();if("function"==typeof effectiveChildren[i].getHaxProperties){const evt=new CustomEvent("hax-register-properties",{bubbles:!0,composed:!0,cancelable:!0,detail:{tag:name,properties:effectiveChildren[i].getHaxProperties(),polymer:!0}});context.dispatchEvent(evt)}else if("function"==typeof effectiveChildren[i].HAXWiring){const evt=new CustomEvent("hax-register-properties",{bubbles:!0,cancelable:!0,composed:!0,detail:{tag:name,properties:effectiveChildren[i].HAXWiring.getHaxProperties(),polymer:!1}});context.dispatchEvent(evt)}else{const basePath=this.pathFromUrl(decodeURIComponent(import.meta.url));if(window.customElements.get(name)){let CEClass=window.customElements.get(name);if(CEClass)if("function"==typeof CEClass.getHaxProperties)this.setHaxProperties(CEClass.getHaxProperties(),name);else if("function"==typeof CEClass.HAXWiring)this.setHaxProperties(CEClass.HAXWiring.getHaxProperties(),name);else if(CEClass.haxProperties)this.setHaxProperties(CEClass.haxProperties,name);else{console.warn(`${name} didn't have hax wiring so HAX guessed how to work with it as best it can. See https://haxtheweb.org/hax-schema for documentation on adding custom wiring for better UX.`);try{let tmpProps,wiring=new HAXWiring,props=wiring.prototypeHaxProperties();if(props.gizmo.title=name,props.gizmo.handles=[],props.settings.quick=[],props.settings.configure=[],props.settings.advanced=[],props=wiring.standardAdvancedProps(props),props.saveOptions={},customElements.get(name)&&(tmpProps=customElements.get(name).properties),tmpProps)for(var propName in tmpProps)if(tmpProps[propName].type&&tmpProps[propName].type.name)switch(tmpProps[propName].type.name){case"String":props.settings.configure.push({property:propName,title:propName,description:"",inputMethod:"textfield"});break;case"Number":props.settings.configure.push({property:propName,title:propName,description:"",inputMethod:"number"});break;case"Boolean":props.settings.configure.push({property:propName,title:propName,description:"",inputMethod:"boolean"})}wiring.readyToFireHAXSchema(name,props,this)}catch(e){console.warn("HAX failed to create wiring that worked")}}else console.error(`${name} was not a valid custom element yet a load was attempted`)}else{let nameLocation=varGet(window.HaxStore,"instance.__appStoreData.autoloader."+name,`@lrnwebcomponents/${name}/${name}.js`);import(`${basePath}../../../${nameLocation}`).then(response=>{let CEClass=window.customElements.get(name);CEClass?"function"==typeof CEClass.getHaxProperties?this.setHaxProperties(CEClass.getHaxProperties(),name):"function"==typeof CEClass.HAXWiring?this.setHaxProperties(CEClass.HAXWiring.getHaxProperties(),name):CEClass.haxProperties?this.setHaxProperties(CEClass.haxProperties,name):console.warn(`${name} didn't have hax wiring in the end`):console.error(`${name} was not a valid custom element yet a load was attempted`)}).catch(error=>{console.warn(error)})}}this.processedList[name]=name}catch(err){}effectiveChildren[i].remove()}}}window.customElements.define(HaxAutoloader.tag,HaxAutoloader);export{HaxAutoloader};